<div *ngIf="(auth.user$ | async) as user">
  <div class="header">
    <div fxLayout="row" fxLayoutAlign="space-between center">
      <mat-icon routerLink="/leaderboard">keyboard_arrow_left</mat-icon>
      <mat-icon (click)="auth.signOut()">power_settings_new</mat-icon>
    </div>

    <h3 class="text-truncate">
      Hello
      <br />
      {{ user.displayName | titlecase }}
    </h3>

    <div class="d-flex justify-content-around pb-2">
      <div class="d-flex align-items-center" routerLink="/profile">
        <img
          id="upload"
          class="img-profile"
          src="{{ user.photoURL }}"
          alt="User Profile Image"
        />
        <div class="edit-img" *ngIf="!user.incognitoMode">
          <img
            class="img-profile"
            src="assets/profile/edit.svg"
            alt="Edit"
            (click)="file.click()"
          />
        </div>

        <mat-progress-spinner
          *ngIf="(uploadPercent | async) !== null"
          color="primary"
          diameter="128"
          strokeWidth="4"
          [mode]="mode"
          value="{{ uploadPercent | async }}"
        ></mat-progress-spinner>
      </div>
    </div>

    <div
      *ngIf="
        (uploadPercent | async) !== 100 && (uploadPercent | async) !== null
      "
    >
      Loading {{ uploadPercent | async }}%
    </div>
    <div *ngIf="(uploadPercent | async) === 100">Upload Completed</div>
  </div>

  <div class="text-center mt-2" *ngIf="user.incognitoMode">
    Only you can see your profile picture!
  </div>

  <div class="form-group fileContainer" hidden>
    <input type="file" (change)="fileChangeEvent($event)" />
    <input
      #file
      id="file"
      type="file"
      accept="image/*"
      (change)="uploadFile($event)"
    />
  </div>

  <form [formGroup]="userForm" class="mt-3">
    <mat-form-field appearance="outline">
      <input
        matInput
        type="text"
        aria-describedby="displayName"
        placeholder="Enter your name"
        value="{{ user.displayName | titlecase }}"
        formControlName="displayName"
      />
    </mat-form-field>

    <mat-form-field appearance="outline">
      <input
        matInput
        type="email"
        aria-describedby="email"
        placeholder="Enter your email"
        value="{{ user.email }}"
        formControlName="email"
      />
    </mat-form-field>
  </form>

  <div class="button-column mt-3">
    <button
      mat-raised-button
      color="primary"
      type="submit"
      *ngIf="user.incognitoMode"
      (click)="openIncognitoDialog()"
    >
      Leave Incognito!
    </button>

    <button
      mat-stroked-button
      color="primary"
      type="button"
      routerLink="/dashboard"
      *ngIf="user.role === 'admin'"
    >
      Go to Admin Dashboard
    </button>

    <!-- <button mat-stroked-button type="button" (click)="openPictureDialog()">
      Open Picture Editing dialog
    </button> -->
  </div>

  <small>v.{{ version }}</small>
  <app-footer></app-footer>
</div>
